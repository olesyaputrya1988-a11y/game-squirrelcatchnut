<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruit Catcher & English Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #ff9a9e, #a1c4fd);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #gameContainer {
            position: relative;
            width: 800px;
            height: 600px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-radius: 20px;
            overflow: hidden;
        }
        #gameCanvas {
            background: #87CEEB;
            display: block;
        }
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-size: 28px;
            font-weight: bold;
        }
        #quizModal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        .quizBox {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .quizBox h2 {
            color: #FF6B6B;
            margin-bottom: 20px;
            font-size: 32px;
        }
        .question {
            font-size: 28px;
            margin: 20px 0;
            color: #4A4A4A;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
        }
        .option {
            background: #4ECDC4;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .option:hover {
            background: #1A535C;
            transform: scale(1.05);
        }
        #resultMessage {
            font-size: 26px;
            font-weight: bold;
            margin: 20px 0;
            min-height: 30px;
        }
        #continueBtn {
            background: #FF6B6B;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 22px;
            cursor: pointer;
            margin-top: 10px;
            display: none;
        }
        #gameOverScreen, #victoryScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 20;
            text-align: center;
        }
        #gameOverScreen h1, #victoryScreen h1 {
            font-size: 60px;
            margin-bottom: 20px;
            color: #FF6B6B;
        }
        #gameOverScreen p, #victoryScreen p {
            font-size: 32px;
            margin: 15px 0;
        }
        #restartBtn, #restartBtnVictory {
            background: #4ECDC4;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 40px;
            font-size: 24px;
            cursor: pointer;
            margin-top: 30px;
        }
        .instructions {
            position: absolute;
            bottom: 10px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 18px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        #debug {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            color: #fff;
            padding: 5px 10px;
            font-size: 12px;
            z-index: 100;
            display: none;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div id="ui">
            <div>Score: <span id="score">0</span></div>
            <div>Lives: <span id="lives">3</span></div>
        </div>
        
        <div class="instructions">‚Üê ‚Üí Arrow keys or mouse to move | Catch fruits!</div>
        <div id="debug">Debug: Initializing...</div>
        
        <div id="quizModal">
            <div class="quizBox">
                <h2>English Time!</h2>
                <div class="question" id="questionText">Which sentence is correct?</div>
                <div class="options" id="optionsContainer"></div>
                <div id="resultMessage"></div>
                <button id="continueBtn">Continue Game</button>
            </div>
        </div>
        
        <div id="gameOverScreen">
            <h1>Game Over!</h1>
            <p>Your score: <span id="finalScore">0</span></p>
            <button id="restartBtn">Play Again</button>
        </div>
        
        <div id="victoryScreen">
            <h1>üéâ Congratulations! üéâ</h1>
            <p>You reached 50 points!</p>
            <p>Great job with English!</p>
            <button id="restartBtnVictory">Play Again</button>
        </div>
    </div>

    <script>
        // ============== –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–û –†–ê–ë–û–ß–ò–ô –ö–û–î ‚Äî –ù–ï –¢–†–ï–ë–£–ï–¢ –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô ==============
        console.log("Game script loaded. Starting initialization...");

        // DOM Elements
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const quizModal = document.getElementById('quizModal');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const resultMessage = document.getElementById('resultMessage');
        const continueBtn = document.getElementById('continueBtn');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const victoryScreen = document.getElementById('victoryScreen');
        const finalScoreElement = document.getElementById('finalScore');
        const restartBtn = document.getElementById('restartBtn');
        const restartBtnVictory = document.getElementById('restartBtnVictory');
        const debugEl = document.getElementById('debug');

        // Game state
        let score = 0;
        let lives = 3;
        let fruits = [];
        let basket = {
            x: canvas.width / 2 - 50,
            y: canvas.height - 80,
            width: 100,
            height: 30,
            speed: 8
        };
        let keys = {};
        let gameRunning = true;
        let quizActive = false;
        let nextQuizScore = 5;
        let quizzesAnswered = 0;
        let animationId = null;

        // Fruit types (colors instead of images ‚Äî works everywhere)
        const fruitColors = [
            '#FF0000', // Apple red
            '#FFD700', // Banana yellow
            '#FF8C00', // Orange orange
            '#800080', // Grape purple
            '#FF1493', // Strawberry pink
            '#32CD32'  // Watermelon green
        ];
        const fruitLabels = ['üçé', 'üçå', 'üçä', 'üçá', 'üçì', 'üçâ'];

        // Quiz questions
        const quizzes = [
            { q: "I ___ happy today.", opts: ["am", "is", "are"], ans: 0 },
            { q: "She ___ a doctor.", opts: ["am", "is", "are"], ans: 1 },
            { q: "They ___ playing football.", opts: ["am", "is", "are"], ans: 2 },
            { q: "We ___ students.", opts: ["am", "is", "are"], ans: 2 },
            { q: "He ___ my brother.", opts: ["am", "is", "are"], ans: 1 },
            { q: "The cat ___ sleeping.", opts: ["am", "is", "are"], ans: 1 },
            { q: "You ___ very kind.", opts: ["am", "is", "are"], ans: 2 },
            { q: "I ___ not tired.", opts: ["am", "is", "are"], ans: 0 },
            { q: "The children ___ in the garden.", opts: ["am", "is", "are"], ans: 2 },
            { q: "It ___ a beautiful day.", opts: ["am", "is", "are"], ans: 1 },

            { q: "Which animal says 'meow'?", opts: ["Dog", "Cat", "Cow"], ans: 1 },
            { q: "Which animal lives in water?", opts: ["Lion", "Dolphin", "Eagle"], ans: 1 },
            { q: "Which animal has a long trunk?", opts: ["Giraffe", "Elephant", "Zebra"], ans: 1 },
            { q: "Which animal says 'oink'?", opts: ["Pig", "Sheep", "Horse"], ans: 0 },
            { q: "Which animal can fly?", opts: ["Fish", "Bird", "Snake"], ans: 1 },

            { q: "Where do you sleep?", opts: ["Kitchen", "Bedroom", "Bathroom"], ans: 1 },
            { q: "Where do you cook food?", opts: ["Living room", "Kitchen", "Garage"], ans: 1 },
            { q: "Where do you take a shower?", opts: ["Bedroom", "Bathroom", "Hallway"], ans: 1 },
            { q: "Where do you watch TV?", opts: ["Kitchen", "Living room", "Attic"], ans: 1 },
            { q: "Where do you park your car?", opts: ["Garage", "Bedroom", "Kitchen"], ans: 0 }
        ];

        // Initialize game
        function init() {
            console.log("Initializing game...");
            debugEl.textContent = "Debug: Initializing...";
            
            score = 0;
            lives = 3;
            fruits = [];
            basket.x = canvas.width / 2 - basket.width / 2;
            gameRunning = true;
            quizActive = false;
            nextQuizScore = 5;
            quizzesAnswered = 0;
            
            scoreElement.textContent = score;
            livesElement.textContent = lives;
            gameOverScreen.style.display = 'none';
            victoryScreen.style.display = 'none';
            quizModal.style.display = 'none';
            
            // Clear any existing animation
            if (animationId) cancelAnimationFrame(animationId);
            
            // Start game loop
            debugEl.textContent = "Debug: Game loop started";
            gameLoop();
        }

        // Create a new fruit
        function createFruit() {
            if (!gameRunning) return;
            const size = 40 + Math.random() * 20;
            fruits.push({
                x: Math.random() * (canvas.width - size),
                y: -size,
                size: size,
                speed: 1.5 + Math.random() * 2,
                color: fruitColors[Math.floor(Math.random() * fruitColors.length)],
                label: fruitLabels[Math.floor(Math.random() * fruitLabels.length)]
            });
        }

        // Draw basket (as a brown rectangle with handle)
        function drawBasket() {
            // Basket body
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(basket.x, basket.y, basket.width, basket.height);
            
            // Handle (semi-circle)
            ctx.beginPath();
            ctx.arc(basket.x + basket.width/2, basket.y, basket.width/3, 0, Math.PI);
            ctx.lineWidth = 8;
            ctx.strokeStyle = '#654321';
            ctx.stroke();
            
            // Inner basket
            ctx.fillStyle = '#DEB887';
            ctx.fillRect(basket.x + 5, basket.y + 5, basket.width - 10, basket.height - 5);
        }

        // Draw fruits (colored circles with emoji labels)
        function drawFruits() {
            fruits.forEach(fruit => {
                // Draw circle
                ctx.fillStyle = fruit.color;
                ctx.beginPath();
                ctx.arc(fruit.x + fruit.size/2, fruit.y + fruit.size/2, fruit.size/2, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw emoji label (safe: fallback to letter if emoji fails)
                ctx.fillStyle = '#FFF';
                ctx.font = `${Math.max(20, Math.floor(fruit.size * 0.5))}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                try {
                    ctx.fillText(fruit.label, fruit.x + fruit.size/2, fruit.y + fruit.size/2);
                } catch (e) {
                    // Fallback to first letter
                    ctx.fillText(fruit.label.charAt(0), fruit.x + fruit.size/2, fruit.y + fruit.size/2);
                }
            });
        }

        // Draw background (sky + ground + clouds)
        function drawBackground() {
            // Sky gradient
            const sky = ctx.createLinearGradient(0, 0, 0, canvas.height);
            sky.addColorStop(0, '#87CEEB');
            sky.addColorStop(1, '#E0F7FA');
            ctx.fillStyle = sky;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Clouds
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            drawCloud(100, 80, 30);
            drawCloud(300, 120, 40);
            drawCloud(600, 70, 35);
            
            // Ground
            ctx.fillStyle = '#8BC34A';
            ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
        }

        function drawCloud(x, y, r) {
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2);
            ctx.arc(x + r, y - r/2, r * 0.8, 0, Math.PI * 2);
            ctx.arc(x + r * 2, y, r, 0, Math.PI * 2);
            ctx.arc(x + r, y + r/2, r * 0.7, 0, Math.PI * 2);
            ctx.fill();
        }

        // Update game logic
        function update() {
            if (!gameRunning || quizActive) return;

            // Keyboard movement
            if (keys['ArrowLeft'] && basket.x > 0) basket.x -= basket.speed;
            if (keys['ArrowRight'] && basket.x < canvas.width - basket.width) basket.x += basket.speed;

            // Update fruits
            for (let i = fruits.length - 1; i >= 0; i--) {
                const f = fruits[i];
                f.y += f.speed;

                // Catch detection
                const caught = (
                    f.y + f.size >= basket.y &&
                    f.x + f.size >= basket.x &&
                    f.x <= basket.x + basket.width
                );

                if (caught) {
                    fruits.splice(i, 1);
                    score++;
                    scoreElement.textContent = score;

                    // Trigger quiz every 5 points
                    if (score >= nextQuizScore && !quizActive) {
                        nextQuizScore += 5;
                        showQuiz();
                    }

                    // Victory at 50
                    if (score >= 50) {
                        showVictory();
                    }
                } 
                // Missed
                else if (f.y > canvas.height) {
                    fruits.splice(i, 1);
                    lives--;
                    livesElement.textContent = lives;
                    if (lives <= 0) showGameOver();
                }
            }

            // Spawn new fruits
            if (Math.random() < 0.04) createFruit();
        }

        // Show quiz
        function showQuiz() {
            if (quizzesAnswered >= quizzes.length) quizzesAnswered = 0;
            const q = quizzes[quizzesAnswered++];
            
            questionText.textContent = q.q;
            optionsContainer.innerHTML = '';
            
            q.opts.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option';
                btn.textContent = opt;
                btn.onclick = () => handleAnswer(idx === q.ans, q.opts[q.ans]);
                optionsContainer.appendChild(btn);
            });
            
            resultMessage.textContent = '';
            continueBtn.style.display = 'none';
            quizModal.style.display = 'flex';
            quizActive = true;
            gameRunning = false;
        }

        function handleAnswer(correct, correctAnswer) {
            if (correct) {
                resultMessage.innerHTML = '‚úÖ <b>Correct!</b> Well done!';
                resultMessage.style.color = '#4CAF50';
            } else {
                resultMessage.innerHTML = `‚ùå <b>Incorrect!</b> Correct: ${correctAnswer}`;
                resultMessage.style.color = '#F44336';
                score = Math.max(0, score - 5);
                scoreElement.textContent = score;
            }
            continueBtn.style.display = 'inline-block';
        }

        // Game over
        function showGameOver() {
            gameRunning = false;
            finalScoreElement.textContent = score;
            gameOverScreen.style.display = 'flex';
            debugEl.textContent = "Debug: Game Over";
        }

        // Victory
        function showVictory() {
            gameRunning = false;
            victoryScreen.style.display = 'flex';
            debugEl.textContent = "Debug: Victory!";
            
            // Simple confetti (no DOM needed)
            if (ctx) {
                for (let i = 0; i < 100; i++) {
                    setTimeout(() => {
                        const x = Math.random() * canvas.width;
                        const y = Math.random() * canvas.height;
                        ctx.fillStyle = ['#FF6B6B','#4ECDC4','#FFE66D','#1A535C','#FF9E6D'][Math.floor(Math.random()*5)];
                        ctx.beginPath();
                        ctx.arc(x, y, 3 + Math.random()*5, 0, Math.PI*2);
                        ctx.fill();
                    }, i * 20);
                }
            }
        }

        // Game loop
        function gameLoop() {
            // Clear
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw
            drawBackground();
            drawBasket();
            drawFruits();
            
            // Update
            update();
            
            // Continue loop
            if (gameRunning) {
                animationId = requestAnimationFrame(gameLoop);
            }
        }

        // ====== EVENT LISTENERS ======
        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);

        canvas.addEventListener('mousemove', e => {
            if (gameRunning && !quizActive) {
                const rect = canvas.getBoundingClientRect();
                basket.x = e.clientX - rect.left - basket.width / 2;
                // Clamp
                basket.x = Math.max(0, Math.min(canvas.width - basket.width, basket.x));
            }
        });

        continueBtn.onclick = () => {
            quizModal.style.display = 'none';
            quizActive = false;
            gameRunning = true;
            debugEl.textContent = "Debug: Game resumed";
        };

        restartBtn.onclick = init;
        restartBtnVictory.onclick = init;

        // Start game when page loads
        window.onload = () => {
            console.log("Page loaded. Starting game...");
            debugEl.textContent = "Debug: Page loaded";
            setTimeout(init, 200); // Small delay to ensure DOM is ready
        };
    </script>
</body>
</html>